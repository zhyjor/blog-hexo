---
title: éƒ½React V18äº†,è¿˜ä¸ä¼šæ­£ç¡®ä½¿ç”¨React Hookså—,ä¸‡å­—é•¿æ–‡è§£æHooksçš„å¸¸è§é—®é¢˜
tags:
  - React
  - js
categories: React
top: false
copyright: true
date: 2022-12-01 14:13:21
---
æ­å·ä¸‹é›ªäº†ï¼Œæƒ³å»è¥¿æ¹–çœ‹é›ªäº†ï¼Œé›ªåçš„æ­å·æ›´æœ‰æ°´å¢¨ç”»é‡Œçš„æ„Ÿè§‰äº†ï¼Œä¸€ä¸‹é›ªæ­å·å°±æˆäº†ä¸´å®‰

ä»Šå¤©ä¸»è¦æƒ³è¯´ä¸€ä¸‹react hooksï¼Œreact hooksæ˜¯react v16.8 ä¹‹åå¼•å…¥çš„APIï¼Œç°åœ¨reactéƒ½å·²ç»åˆ°18äº†ï¼Œhooksæ€ä¹ˆè¿˜èƒ½ä¸ä¼šç”¨å‘¢ã€‚hookså¼•å…¥çš„ç›®çš„æ˜¯ç»™å‡½æ•°å¼ç»„ä»¶å¢åŠ æ•°æ®çŠ¶æ€ç®¡ç†çš„èƒ½åŠ›ï¼ŒåŒæ—¶å¢åŠ ä»£ç çš„å¯å¤ç”¨èƒ½åŠ›ã€‚ä½†æ˜¯åŒæ—¶hooksä¹Ÿæ˜¯ä¸€ä¸ªæ½˜å¤šæ‹‰é­”ç›’ï¼Œå› ä¸ºå‡½æ•°å¼ç»„ä»¶ä¸å†åªæ˜¯å•çº¯çš„ä¸€ä¸ªçº¯å‡½æ•°äº†ï¼Œå¯ä»¥åœ¨å†…éƒ¨å¤„ç†å‰¯ä½œç”¨äº†ï¼Œä½¿ç”¨ä¸å¥½å°±ä¼šç»å¸¸é‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ï¼Œè€Œä¸”é”™è¯¯çš„ä½¿ç”¨æ–¹å¼ä¹Ÿä¼šå¼•èµ·re-renderï¼Œå¼•èµ·ä¸€äº›æ€§èƒ½ä¸Šçš„é—®é¢˜

æœ¬æ–‡ä¸»è¦ä»‹ç»hooksçš„å¸¸è§çš„å‡ ä¸ªé—®é¢˜ä¸æœ€ä¼˜å®è·µï¼ŒåŒæ—¶ä»‹ç»ä¸€ä¸‹éšç€reactç‰ˆæœ¬è¿­ä»£çš„APIçš„å˜åŒ–

é—²è¨€å°‘å™ï¼Œç›´æ¥è¿›å…¥æ­£æ–‡
<!--more-->
é¦–å…ˆï¼Œåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œç¬”è€…è¿˜æ˜¯æƒ³å¼ºè°ƒä¸€ä¸‹

**è¯·é…ç½®ä¸Š`eslint-plugin-react-hooks`**
**è¯·é…ç½®ä¸Š`eslint-plugin-react-hooks`**
**è¯·é…ç½®ä¸Š`eslint-plugin-react-hooks`**

hooksçš„çš„ä½¿ç”¨ç¡®å®å¾ˆçˆ½ï¼Œä½†æ˜¯å’Œçº¯å‡½æ•°ç›¸æ¯”ï¼Œè¿˜æ˜¯æœ‰æŒºå¤šåç›´è§‰çš„å†™æ³•çš„ï¼Œæ¯”å¦‚ä¸èƒ½åœ¨åˆ¤æ–­è¯­å¥ä¸­ä½¿ç”¨hooksã€‚è¿™å°±å¾ˆå®¹æ˜“æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å·¥å…·æ¥è§„é¿è¿™äº›é—®é¢˜ï¼Œæ¥æé†’æˆ‘ä»¬æœ‰äº›å†™æ³•æ˜¯é”™è¯¯çš„ã€‚å½“ç„¶hooksçš„æœ‰å…¶è‡ªå·±çš„åˆç†æ€§é—®é¢˜ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸åšè®¨è®ºï¼Œè¿™ä¸ªæ’ä»¶æé†’å¯ä»¥ä¿è¯è®©æˆ‘ä»¬çš„å†™æ³•æ˜¯ç¬¦åˆå½“å‰è§„èŒƒçš„ï¼Œä¸è‡³äºå‡ºç°ä½çº§é—®é¢˜
## å¼‚æ­¥è°ƒç”¨çš„é—­åŒ…é—®é¢˜
ç»Ÿè®¡1ç§’å†…æŒ‰é’®ç‚¹å‡»çš„æ¬¡æ•°ï¼Œå…ˆçœ‹ä»£ç ï¼š
```js
export default function Demo() {
  const [number, setNumber] = React.useState(0);
  const click = () =>
    setTimeout(() => {
      setNumber(number + 1);
    }, 1000);
  return <button onClick={click}> ç‚¹å‡» {number} æ¬¡</button>;
}
```
å½“å¤šæ¬¡ç‚¹å‡»çš„æ—¶å€™çš„æ—¶å€™ï¼Œæ˜¾ç¤ºçš„ç‚¹å‡»æ¬¡æ•°é”™è¯¯ã€‚ç‚¹å‡»clickæ–¹æ³•å†…çš„é—­åŒ…å›è°ƒå‡½æ•°åœ¨ç»„ä»¶renderçš„æ—¶å€™æ•è·äº†numberå˜é‡ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥ä½¿ç”¨å‡½æ•°æ–¹æ³•æ¥æ›´æ–°æ•°æ®
```js
const click = () =>
    setTimeout(() => {
      setNumber(number => number + 1);
    }, 1000);
```
åœ¨è°ƒç”¨çŠ¶æ€æ›´æ–°å‡½æ•°çš„æ—¶å€™ï¼Œä¼šå°†å‡†ç¡®çš„æ•°æ®å›è°ƒç»™å½“å‰çš„æ›´æ–°å‡½æ•°

### æ›´è¿‘ä¸€æ­¥
åŒæ ·çš„ï¼Œå‡å¦‚æˆ‘ä»¬ç»Ÿè®¡å¼€å±3ç§’å†…çš„ç‚¹å‡»æ¬¡æ•°ï¼Œåœ¨è®¡æ—¶ç»“æŸåï¼Œå°†ç‚¹å‡»æ¬¡æ•°å‘é€ç»™serverç«¯çš„æ—¶å€™ï¼Œå°±ä¼šé‡åˆ°å¦ä¸€ä¸ªé—®é¢˜
```js
export default function Demo() {
  const [number, setNumber] = React.useState(0);
  useEffect(() => {
    const timer = setTimeout(() => {
      // do fetch
      console.log(number);
    }, 1000);
    return () => {
      clearTimeout(timer);
    };
    // ä¾èµ–è¿™é‡Œä¼šæœ‰ä¸ªè­¦å‘Š
  }, []);

  return <button onClick={() => setNumber((c) => c + 1)}>ç‚¹å‡»{number}æ¬¡</button>;
}

```
é¦–å…ˆæˆ‘ä»¬ä¼šé‡åˆ°ä¸€ä¸ª`eslint-plugin-react-hooks`è­¦å‘Š
```js
React Hook useEffect has a missing dependency: 'number'. Either include it or remove the dependency array. (react-hooks/exhaustive-deps)
```
è€Œä¸”æ‰§è¡Œç»“æœä¹Ÿæ˜¯ç”±äºé—­åŒ…çš„åŸå› ä¸èƒ½æ­£å¸¸æäº¤ï¼Œç†Ÿæ‚‰useEffectåˆ°éƒ½çŸ¥é“ï¼Œè¿™ä¸ªåŸå› æ˜¯ä½¿ç”¨useEffectçš„æ—¶å€™ï¼Œä¾èµ–éœ€è¦æ·»åŠ åˆ°ä¾èµ–æ•°ç»„å†…ï¼Œè¿™æ ·æ‰èƒ½æ›´æ–°æ•°æ®åˆ°useEffectå†…ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ·»åŠ äº†ä¾èµ–åï¼Œæ¯æ¬¡ç‚¹å‡»éƒ½ä¼šå¼•èµ·è®¡æ—¶å™¨é‡æ–°æ‰§è¡Œï¼Œå¼•èµ·å€’è®¡æ—¶å¤±æ•ˆï¼Œå°±å’Œéœ€æ±‚æœ‰å†²çªäº†ï¼Œé‚£è¿™ç§æƒ…å†µä¸‹æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ

è¿™ä¸ªé—®é¢˜å…¶å®å¯ä»¥ç®€å•å½’ç´¯ä¸ºï¼š**ä¸æƒ³è®©useEffecté‡æ–°æ‰§è¡Œçš„ä¾èµ–æ€ä¹ˆä½¿ç”¨çš„é—®é¢˜**ï¼Œè¿™ä¸ªåœºæ™¯ä¸‹å°±åªèƒ½ä½¿ç”¨useRefæ¥å®ç°äº†
```js
export default function Demo() {
  const [number, setNumber] = React.useState(0);
  const numberRef = useRef(number);
  numberRef.current = number;
  useEffect(() => {
    const timer = setTimeout(() => {
      // do fetch
      console.log(numberRef.current);
    }, 1000);
    return () => {
      clearTimeout(timer);
    };
  }, []);

  return (
    <button onClick={() => setNumber((c) => c + 1)}>ç‚¹å‡»{number}æ¬¡</button>
  );
}

```
é€šè¿‡useRefå¯ä»¥æ¥ä¿è¯è®¿é—®åˆ°çš„numberä¸€ç›´æ˜¯æœ€æ–°çš„ï¼Œè§£å†³äº†é—­åŒ…çš„é—®é¢˜ï¼ŒåŒæ—¶useEffectæœªç›´æ¥ä¾èµ–numberï¼Œå½“numberå˜åŒ–çš„æ—¶å€™ä¸ä¼šå¼•èµ·é‡æ–°æ‰§è¡Œ

### å°ç»“
è™½ç„¶å’Œhooksçš„å†™æ³•æœ‰å…³ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯é—­åŒ…é—®é¢˜ï¼Œæ¯”å¦‚forEachå†…å†™çš„å®šæ—¶å™¨ä¹Ÿä¼šæœ‰åŒæ ·çš„é—®é¢˜ï¼›ä½†æ˜¯å¯¹äºå¼‚æ­¥åœºæ™¯ä¸‹çš„å†™æ³•ï¼Œ**ä¸æƒ³å¼•èµ·useEffecté‡æ–°æ‰§è¡Œçš„å˜é‡ï¼Œå°±å¯ä»¥ç”¨useRefåšä¸€å±‚ä»£ç†**ï¼Œè¿™ç§ç”¨æ³•åªèƒ½è¯´æ˜¯å¯¹react hooksè®¾è®¡çš„
ä¸€ç§å¦¥å

## ç”¨useCallbackè‚¯å®šèƒ½æå‡æ€§èƒ½å—
useCallbackçš„ä½œç”¨æ˜¯ç¼“å­˜å‡½æ•°ï¼Œé¿å…é‡å¤ç”Ÿæˆæ–°å‡½æ•°ï¼Œå¼•èµ·ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œæ¯”å¦‚ï¼š
```js
const Children = (props) => <button onClick={props.doFetch}>æäº¤</button>;

export default function Demo() {
  const doFetch = useCallback(() => {
    // fetch();
  }, []);

  return <Children doFetch={doFetch} />;
}
```
è¿™æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„å†™æ³•ï¼Œä½†æ˜¯éœ€è¦æ˜ç¡®åœ¨classç»„ä»¶çš„æ—¶å€™æˆ‘ä»¬é€šå¸¸ä½¿ç”¨`shouldComponentUpdate`æ¥æ‹¦æˆªæ›´æ–°ï¼Œé€šè¿‡æ¯”è¾ƒçˆ¶ç»„ä»¶ä¼ å…¥çš„propsçš„å˜åŒ–ï¼Œæ¥è§‰å¾—æ˜¯å¦re-renderå­ç»„ä»¶ï¼Œä¸Šé¢çš„ğŸŒ°ä¸­ï¼Œ`<Children />`åªæ˜¯ä¸€ä¸ªæ™®é€šç»„ä»¶ï¼Œåªå¯¹ä¼ å…¥çš„å‡½æ•°åŒ…è£¹ä¸€å±‚useCallbackæ˜¯ä¸èƒ½èµ·åˆ°ä¼˜åŒ–ä½œç”¨çš„ï¼Œéœ€è¦é€šè¿‡åŒ…è£¹ä¸€å±‚`React.memo`æ‰å¯ä»¥ï¼ŒReact.memoä¼šå¯¹å¯¹ä¼ å…¥çš„propsè¿›è¡Œä¸€æ¬¡æµ…æ¯”è¾ƒï¼Œé¿å…éå¿…è¦çš„æ›´æ–°ï¼Œå¦‚ä¸‹
```js
const Children = React.memo((props) => <button onClick={props.doFetch}>æäº¤</button>);
```
å¦å¤–éœ€è¦è¡¥å……çš„æ˜¯ï¼Œå‡å¦‚æœ‰ä¸€äº›ç‰¹åˆ«å¤æ‚çš„å¯¹è±¡å±æ€§éœ€è¦ä¼ å…¥çš„è¯ï¼Œå¯ä»¥è€ƒè™‘é€šè¿‡useMemoè¿›è¡Œä¸€å±‚åŒ…è£¹ï¼Œé¿å…ä¸€äº›ä¸å¿…è¦çš„re-renderã€‚å½“ç„¶ï¼Œä½¿ç”¨useMemoä¹Ÿæ˜¯æœ‰ä¸€å®šçš„æ€§èƒ½æˆæœ¬çš„ï¼Œå‡å¦‚åªæ˜¯ç®€å•è®¡ç®—çš„è¯ï¼Œç›´æ¥è®¡ç®—å°±å¯ä»¥äº†ï¼Œå¯èƒ½è¿™æ ·çš„æˆæœ¬è¿˜å°ä¸€äº›ã€‚

### æ€è€ƒé¢˜
ä¸‹é¢è¿™ä¸ªåœºæ™¯ä¸‹useCallbackå’ŒReact.memoç»„åˆå¯ä»¥èµ·åˆ°ä¼˜åŒ–çš„ä½œç”¨å—ï¼Ÿ
```js
const Children = React.memo((props) => <button onClick={props.doSubmit}>æäº¤</button>);

export default function Demo() {
  const [number, setNumber] = useState(0);

  const doSubmit = useCallback(() => {
    console.log(`Number: ${number}`); // æ¯æ¬¡è¾“å‡ºéƒ½æ˜¯åˆå§‹å€¼
  }, [number]); // æŠŠ`text`å†™åœ¨ä¾èµ–æ•°ç»„é‡Œ

  return (
    <>
      <input value={number} onChange={(e) => setNumber(e.target.value)} />
      <Children doSubmit={doSubmit} />
    </>
  );
}
```
ç»“è®ºæ˜¯ä¸è¡Œï¼ŒåŸå› å¯ä»¥è€ƒè™‘ä¸€ä¸‹useCallbackçš„depsè¯¥æ€ä¹ˆå¤„ç†

### å°ç»“
åªéœ€è¦è®°å¾—**ä½¿ç”¨useCallbackçš„æ—¶å€™ï¼Œå¯¹åº”çš„å­ç»„ä»¶ä¸€å®šè¦ä½¿ç”¨React.memoåŒ…è£¹**ï¼Œå¦åˆ™ä½¿ç”¨useCallbackå°±æ²¡æœ‰ä»»ä½•çš„æ„ä¹‰ã€‚å½“ç„¶useCallbackçš„depsè¦æ ¹æ®å®é™…åœºæ™¯æ¥æ·»åŠ ï¼Œå¦åˆ™å°±ä¸ä¼šæœ‰ä»»ä½•çš„ä¼˜åŒ–æ•ˆæœã€‚

å¦å¤–å¯¹äºuseCallbackï¼Œç¬”è€…ä¸ªäººçš„ç†è§£æ˜¯æœ‰äº›ç ´åä»£ç çš„å¯è¯»æ€§äº†ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦æŒ‰ç…§åœºæ™¯å…·ä½“è¯„ä¼°ä¸€ä¸‹ï¼Œæ˜¯å¦çœŸçš„éœ€è¦æ— è„‘ä½¿ç”¨ï¼Œå¹³è¡¡å¥½ä»£ç å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½

## hooksç»„ä»¶æ€ä¹ˆä¼˜é›…çš„ä½¿ç”¨refs
å…¶å®è¿™ä¸ªé—®é¢˜æœ‰äº›ä¼ªå‘½é¢˜çš„æ„Ÿè§‰ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨åœ¨çˆ¶ç»„ä»¶ä¸­é€šè¿‡refæ“ä½œå­ç»„ä»¶çš„æ–¹æ³•æ—¶ï¼Œå·²ç»å°±æ˜¯ä¸ä¼˜é›…çš„äº†ã€‚å®˜æ–¹æ–‡æ¡£è¿™æ ·è¯´ï¼š
> åœ¨å¸¸è§„çš„ React æ•°æ®æµä¸­ï¼Œprops æ˜¯çˆ¶ç»„ä»¶ä¸å­ç»„ä»¶äº¤äº’çš„å”¯ä¸€æ–¹å¼ã€‚è¦ä¿®æ”¹å­å…ƒç´ ï¼Œä½ éœ€è¦ç”¨æ–°çš„ props å»é‡æ–°æ¸²æŸ“å­å…ƒç´ 

åªèƒ½è¯´éå¿…è¦çš„å°½é‡é¿å…ç›´æ¥ä½¿ç”¨refå§ï¼Œå°½é‡é¿å…æ‰“ä¹±reactçš„å•å‘æ•°æ®æµã€‚é‚£å›åˆ°æˆ‘ä»¬çš„é—®é¢˜ï¼Œä½¿ç”¨hooksçš„æ—¶å€™å¦‚ä½•ä½¿ç”¨æ›´ä¼˜é›…çš„ä½¿ç”¨refå‘¢

å®˜æ–¹æ–‡æ¡£æä¾›äº†ä»¥ä¸‹å‡ ä¸ªåœºæ™¯åˆšå¥½é€‚åˆä½¿ç”¨Refs
* å¤„ç†focusã€æ–‡æœ¬é€‰æ‹©æˆ–è€…åª’ä½“æ’­æ”¾
* è§¦å‘å¼ºåˆ¶åŠ¨ç”»
* åŸºå±‚ç¬¬ä¸‰æ–¹åº“

### useRef
ç”±äºå‡½æ•°ç»„ä»¶æ²¡æœ‰å®ä¾‹ï¼Œåœ¨å‡½æ•°ç»„ä»¶å†…ä¸èƒ½ä½¿ç”¨string ref,callback ref, create refï¼Œä¼šæœ‰å¦‚ä¸‹æŠ¥é”™
> Uncaught Invariant Violation: Function components cannot have refs. Did you mean to use React.forwardRef()?

æ‰€ä»¥åœ¨å‡½æ•°ç»„ä»¶å†…æ˜¯èƒ½ä½¿ç”¨useRef,ç”±äºuseRefè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åªæœ‰currentä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼çš„åœ°å€åœ¨æ•´ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥useRefæä¾›äº†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…å…±äº«æ•°æ®çš„å­˜å‚¨ï¼Œä¿®æ”¹äº†ref.currentçš„å€¼ä¸ä¼šè§¦å‘ç»„ä»¶re-renderï¼Œè€Œä¸”ç»„ä»¶re-renderçš„æ—¶å€™ï¼Œref.currentçš„å€¼ä¹Ÿä¼šä¿ç•™ï¼Œç±»ä¼¼classç»„ä»¶çš„é™æ€å˜é‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨useRefåšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚æŒ‚è½½ç‰¹å®šçš„domæˆ–è€…å­ç»„ä»¶çš„å®ä¾‹ã€å­˜å‚¨å…¨å±€å®šæ—¶å™¨ç­‰ç­‰

é‚£useRefæ€ä¹ˆä½¿ç”¨å‘¢ï¼Œé’ˆå¯¹å®˜æ–¹é—®é¢˜æä¾›çš„å‡ ä¸ªåœºæ™¯ï¼Œç¬”è€…ç®€å•ç»™å‡ºå‡ ä¸ªdemo

#### è·å–ç‰¹å®šdom
å¯¹äºåŸç”Ÿå…ƒç´ å¯ä»¥ç›´æ¥ä½¿ç”¨
```jsx
function Input(props) {
  const inputRef = useRef(null);

  function click() {
    inputRef.current.focus();
  }

  return (
    <div>
      <input type="text" ref={inputRef} />
      <input type="button" value="Focus the text input" onClick={click} />
    </div>
  );
}
```
é€šè¿‡ref.currentå¯ä»¥ç›´æ¥æ“ä½œinput

### useRef,forwardRef,useImperativeHandleç»„åˆç”¨æ³•
é¦–å…ˆå…ˆè¯´ä¸€ä¸‹forwardRef
> Ref è½¬å‘æ˜¯ä¸€é¡¹å°† ref è‡ªåŠ¨åœ°é€šè¿‡ç»„ä»¶ä¼ é€’åˆ°å…¶ä¸€å­ç»„ä»¶çš„æŠ€å·§ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨ä¸­çš„ç»„ä»¶æ¥è¯´ï¼Œè¿™é€šå¸¸ä¸æ˜¯å¿…éœ€çš„ã€‚ä½†å…¶å¯¹æŸäº›ç»„ä»¶ï¼Œå°¤å…¶æ˜¯å¯é‡ç”¨çš„ç»„ä»¶åº“æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚

ç®€ç­”æ¥è¯´ï¼Œå°±æ˜¯å‡½æ•°å¼ç»„ä»¶è¦æƒ³æš´éœ²ç»™çˆ¶ç»„ä»¶refçš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨forwardRefæ‰èƒ½è¿›è¡Œrefçš„ä¼ é€’ã€‚éœ€è¦æ˜ç¡®çš„æ˜¯**ä¸èƒ½åœ¨å‡½æ•°å¼ç»„ä»¶ä¸Šä½¿ç”¨refå±æ€§ï¼Œå› ä¸ºå‡½æ•°å¼ç»„ä»¶æ²¡æœ‰å®ä¾‹**ï¼Œä½¿ç”¨çš„è¯ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚

ç„¶åå†è¯´ä¸€ä¸‹useImperativeHandleï¼Œå‡½æ•°å¼ç»„ä»¶ä½¿ç”¨useImperativeHandle å¯ä»¥é€šè¿‡ forwardRef æš´éœ²ç»™çˆ¶ç»„ä»¶çš„è‡ªå®šä¹‰æ–¹æ³•ã€‚è¿™å¯ä»¥ç±»æ¯”äºclassç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡classç»„ä»¶è·å–refçš„ç»„ä»¶å®ä¾‹ï¼Œè¿›è€Œè°ƒç”¨å†…éƒ¨æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡useImperativeHandleæš´éœ²çš„æ–¹æ³•ï¼Œè°ƒç”¨å‡½æ•°å¼ç»„ä»¶çš„å†…éƒ¨æ–¹æ³•ï¼Œç›´æ¥çœ‹ğŸŒ°
```jsx
import React, { useRef, useImperativeHandle } from "react";
const Children = React.forwardRef((props, ref) => {
  const inputRef = useRef(null);
  useImperativeHandle(
    ref,
    () => {
      const handleRefs = {
        onFocus() {
          inputRef.current.focus();
        }
      };
      return handleRefs;
    },
    []
  );
  return <input placeholder="è¯·è¾“å…¥" ref={inputRef} />;
});

const Demo = () => {
  const childRef = useRef(null);
  const click = () => {
    const { onFocus } = childRef.current;
    onFocus();
  };
  return (
    <>
      <Children ref={childRef} />
      <button onClick={click}>è¾“å…¥æ¡†focused</button>
    </>
  );
};

export default Demo;
```

useImperativeHandle æ¥å—ä¸‰ä¸ªå‚æ•°ï¼š
* forWardRefè½¬å‘è¿‡æ¥çš„ref
* è‡ªå®šä¹‰å¤„ç†å‡½æ•°ï¼Œè¿”å›å€¼æ—¶æš´éœ²ç»™çˆ¶ç»„ä»¶çš„refå¯¹è±¡
* ä¾èµ–é¡¹depsï¼Œæ ¹æ®å®é™…çš„ä¾èµ–ä¼ å…¥å³å¯ï¼Œç”¨äºæ›´æ–°refå¯¹è±¡

é€šè¿‡useImperativeHandleå¤–éƒ¨ç»„ä»¶å°±å¯ä»¥ç›¸å¯¹ä¼˜é›…çš„è·å–åˆ°å­ç»„ä»¶çš„â€œå®ä¾‹â€ï¼Œè°ƒç”¨å­ç»„ä»¶çš„å†…éƒ¨æ–¹æ³•

### å°ç»“
å†™åˆ°è¿™é‡Œï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿèƒ½å‘ç°ï¼ŒuseRefçš„ä½¿ç”¨é¢‘ç‡è¿˜æ˜¯æŒºé«˜çš„ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥æŠŠuseRefå½“æˆæ™®é€šçš„refçš„ç›¸å…³APIï¼Œç”¨æ¥æ“ä½œå­ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥å°†å…¶ä½œä¸ºä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶å†…çš„é™æ€å˜é‡æ¥ä½¿ç”¨ï¼Œå¯ä»¥è¯´æ˜¯hooksé‡åˆ°é—®é¢˜çš„æ—¶å€™éå¸¸ä¸‡é‡‘æ²¹çš„å­˜åœ¨äº†

è¯´å›ref,åŸºæœ¬å¯¹äºå‡½æ•°å¼ç»„ä»¶æ¥è¯´ï¼ŒuseRef,forwardRef,useImperativeHandleç»„åˆç”¨æ³•èƒ½è¦†ç›–æ‰€æœ‰éœ€æ±‚äº†ï¼Œä½†æ˜¯è¿˜æ˜¯é‚£å¥è¯ï¼Œèƒ½å°½é‡é¿å…ä½¿ç”¨çš„å°±é¿å…ä½¿ç”¨ï¼Œè®©è‡ªå·±çš„ä»£ç æœ‰æ›´é«˜çš„å¯ç»´æŠ¤æ€§


## å¦‚ä½•å°è£…è‡ªå®šä¹‰hooks
è‡ªå®šä¹‰hooksæ˜¯åŸºäºreact hooks apiçš„è‡ªå®šä¹‰æ‰©å±•ï¼Œå¯ä»¥å°†ä¸€æ®µé€šç”¨æ€§é€»è¾‘å°è£…èµ·æ¥ï¼Œè¾¾åˆ°å¤ç”¨çš„æ•ˆæœ; ç®€å•æ¥è¯´é€šè¿‡è‡ªå®šä¹‰ Hookï¼Œå¯ä»¥å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ï¼Œå¯ä»¥åœ¨ç»„ä»¶å†…ç›´æ¥ä½¿ç”¨

å°è£…çš„è‡ªå®šä¹‰hooksä¸€èˆ¬å†…éƒ¨ä½¿ç”¨å¤šä¸ªreact hooksï¼Œç”¨äºè§£å†³ä¸€äº›å¤æ‚ä¸”é€šç”¨çš„é€»è¾‘ã€‚æ¥ä¸‹æ¥çœ‹å‡ ä¸ªğŸŒ°ï¼Œç„¶åå¯ä»¥å¯¹æ¯”ä¸€ä¸‹è‡ªå·±çš„åœºæ™¯ï¼Œå½“ç„¶ä¹Ÿå¹¶ä¸æ˜¯æ‰€æœ‰èƒ½ç”¨è‡ªå®šä¹‰hooksçš„åœ°æ–¹ï¼Œå°±å¿…é¡»è¦ç”¨è‡ªå®šä¹‰hooksçš„ï¼Œè¿˜æ˜¯è¦åˆ¤æ–­ä¸€ä¸‹å¯å¤ç”¨ç¨‹åº¦å†åšå†³å®š

### æå–è‡ªå®šä¹‰ hooks
> å½“æˆ‘ä»¬æƒ³åœ¨ä¸¤ä¸ªå‡½æ•°ä¹‹é—´å…±äº«é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬ä¼šæŠŠå®ƒæå–åˆ°ç¬¬ä¸‰ä¸ªå‡½æ•°ä¸­ã€‚è€Œç»„ä»¶å’Œ Hook éƒ½æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ä¹ŸåŒæ ·é€‚ç”¨è¿™ç§æ–¹å¼ã€‚

è‡ªå®šä¹‰ hooks æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åç§°ä»¥ â€œuseâ€ å¼€å¤´ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–çš„ Hookã€‚è‡ªå®šä¹‰hookså’Œæ™®é€šçš„å‡½æ•°å¹¶æ²¡æœ‰ä»»ä½•ä¸åŒï¼Œä½†æ˜¯ç»“åˆå…¬å…±hooks APIçš„èƒ½åŠ›ï¼Œåœ¨reactçš„è°ƒåº¦ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å¾ˆå¤šå¾ˆæœ‰è¶£çš„åŠŸèƒ½ï¼Œç¤¾åŒºæœ‰å®ç°çš„[ahooks](https://github.com/alibaba/hooks?spm=ata.21736010.0.0.1b261134fcWTYx)è‡ªå®šä¹‰hooksåº“ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å‚è€ƒä¸€ä¸‹

æ¥ä¸‹æ¥ç®€å•æ”¾å‡ ä¸ªç›¸å¯¹æœ‰ä»£è¡¨æ€§çš„ğŸŒ°ï¼š

### useStateå±æ€§åˆå¹¶
ä½ çš„ä»£ç é‡Œæ˜¯ä¸æ˜¯å†™è¿‡è¿™æ ·çš„ä»£ç 
```js
const [duration, setDuration] = useState(0);
const [currentTime, setCurrentTime] = useState(0);
const [volume, setCurrent] = useState(0);
const [speed, setSpeed] = useState(0);
...
```
è¿™æ®µä»£ç æ˜¯ä¹‹å‰å°è£…æ’­æ”¾å™¨çš„ä¸€æ®µä»£ç ï¼Œé‡Œé¢å¯¹videoçš„å±æ€§è¿›è¡Œä¸€å®šçš„æå–ï¼Œå¯¼è‡´äº†ä»£ç ä¸­ä¸€æ’è”šä¸ºå£®è§‚çš„useState,è¿™æ ·çš„å†™æ³•å…¶å®å¯ä»¥ä¼˜åŒ–åˆ°ä¸€ä¸ªå­—æ®µå†…
```js
const [player, setPlayer] = useState({
  duration: 0,
  currentTime: 0,
  volume: 0,
  speed: 0,
});
```
å½“ç„¶è¿™ä¸ªæ—¶å€™æ›´æ–°è£…çŠ¶æ€éœ€è¦å¸¦ä¸Šæ—§çš„çŠ¶æ€
```js
setPlayer({...player, duration});
```
é‚£æ€ä¹ˆæ‰èƒ½å†çœç‚¹ä»£ç ï¼Œè®©æˆ‘å¯ä»¥ç›´æ¥ä¿®æ”¹éœ€è¦ä¿®æ”¹çš„å‚æ•°ï¼Œä¸éœ€è¦æ”¹å˜çš„ä¾æ—§ä¿æŒç°çŠ¶å‘¢ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å°è£…ä¸€ä¸ªè‡ªå®šä¹‰hooksï¼Œå¦‚ä¸‹
```js
import { useState } from 'react';

const useMergeState = (initialState) => {
  const [state, setState] = useState(initialState);
  const setMergeState = (pickState) => {
    setState(preState => {...preState, {...pickState}});
  }
  return [state, setMergeState]
}
```
è¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†
```js
const [player, setPlayer] = useMergeState({
  duration: 0,
  currentTime: 0,
  volume: 0,
  speed: 0,
});

setPlayer({ duration: 2});
```
è¿™å°±æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„è‡ªå®šä¹‰hooksï¼Œå½“ç„¶useMergeStateè¿˜æœ‰å¯ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæ¯”å¦‚å‚è€ƒuseStateçš„ç”¨æ³•ï¼ŒpickStateå¯èƒ½æ˜¯ä¸ªå‡½æ•°ï¼Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹å…¥å‚ç±»å‹ï¼›ç„¶åå†…éƒ¨çš„å®ç°setMergeStateå…¶å®å¯ä»¥é€šè¿‡useCallbackè¿›è¡Œä¸€ä¸‹åŒ…è£¹ï¼Œè®©å‡½æ•°ä¸ç”¨æ¯æ¬¡éƒ½åˆå§‹åŒ–ç­‰ç­‰

### domç›¸å…³çš„hooks
æˆ‘ä»¬ç»å¸¸ä¼šç›‘å¬domçš„æ»šåŠ¨æ¥åšä¸€äº›è‡ªå®šä¹‰çš„é€»è¾‘ï¼Œæ¯”å¦‚æ»šåŠ¨ç¿»é¡µç­‰ç­‰ï¼Œä¸€ä¸ªç›‘å¬æ»šåŠ¨çš„è‡ªå®šä¹‰hooksè¯¥æ€ä¹ˆå®ç°å‘¢ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç¡®å®šæˆ‘ä»¬éœ€è·å–åˆ°å“ªäº›å€¼ï¼Œä»¥åŠæˆ‘ä»¬çš„å…¥å‚æ•°æ˜¯ä»€ä¹ˆ
#### éœ€æ±‚åˆ†æ
å…¥å‚ï¼šæ¯‹åº¸ç½®ç–‘è‚¯å®šæ˜¯domå…ƒç´ çš„å¼•ç”¨ï¼Œå¯ä»¥ä½¿ç”¨useRefæ¥å®ç°
è¿”å›å€¼ï¼šä¸€èˆ¬éƒ½æ˜¯å…ƒç´ æ»šåŠ¨çš„é«˜åº¦ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…æ¥å†³å®š

#### ä»£ç å®ç°
```js
import { useState, useEffect } from 'react'

const useScroll = (target) => {
  const [position, setPosition] = useState();

  useEffect(() => {
    function onscroll(e){
      setPos([target.current.scrollLeft, target.current.scrollTop])
    }
    target.current.addEventListener('scroll', onscroll, false)
    return () => {
      target.current.removeEventListener('scroll', onscroll, false)
    }
  }, [])

  return position
}

export default useScroll
```
ä¸Šè¿°ä»£ç ä¹Ÿæ˜¯æœ‰ä¸€äº›å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä¸€äº›å‚æ•°æœ‰æ•ˆæ€§çš„åˆ¤æ–­ç­‰ï¼Œè¿™ä¸ªğŸŒ°åªæ˜¯ä¸€ä¸ªæ¼”ç¤ºï¼Œæä¾›ä¸€ä¸ªå‚è€ƒæ€è·¯

### é˜²æŠ–å‡½æ•°
é˜²æŠ–èŠ‚æµå‡½æ•°å¤§å®¶è‚¯å®šç»å¸¸åœ¨å¼€å‘ä¸­é‡åˆ°ï¼Œé¢è¯•çš„ä¼°è®¡ä¹Ÿæ²¡æœ‰è¢«å°‘é—®ã€‚ä¸€èˆ¬éƒ½æ˜¯æˆ‘ä»¬é¿å…é¢‘ç¹è°ƒç”¨æ¥å£ï¼Œæˆ–è€…åœ¨reactä¸­é¿å…é¢‘ç¹æ”¹åŠ¨stateçš„æ—¶å€™éœ€è¦ä½¿ç”¨çš„ï¼Œé˜²æŠ–èŠ‚æµçš„åŒºåˆ«è¿™é‡Œä¹Ÿä¸èµ˜è¿°äº†ï¼Œç®€å•æ¥è¯´ä¸»è¦åŒºåˆ«å°±æ˜¯é˜²æŠ–æ˜¯æ“ä½œånç§’å†…åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œå‡å¦‚nç§’å†…åˆè§¦å‘äº†æ“ä½œï¼Œé‡æ–°å€’è®¡æ—¶nç§’ï¼›èŠ‚æµå°±æ˜¯æ“ä½œnç§’å†…åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œå³ä½¿æ˜¯å¤šæ¬¡è§¦å‘æ“ä½œä¹Ÿæ˜¯nç§’å†…æ‰§è¡Œä¸€æ¬¡ï¼›èŠ‚æµä¸€èˆ¬ç”¨åœ¨è¾“å…¥æ¡†æœç´¢ï¼Œéœ€è¦åœ¨æœ€åä¸€æ¬¡æäº¤åè§¦å‘ï¼›èŠ‚æµä¸€èˆ¬ç”¨åœ¨æ»šåŠ¨ç›‘å¬ç­‰ç­‰ã€‚

#### ä»£ç å®ç°
```js
import { useEffect, useMemo } from 'react';
import debounce from 'lodash/debounce';

const useDebounce = (fn, wait) => {
  const wait = wait ?? 1000;

  const debounced = useMemo(
      () =>
        debounce(
          fn(),
          wait
        ),
      [],
  );
  return [debounced.run, debounced.cancel];
}
```
ä¸Šè¿°ä»£ç ä¸ºäº†çªå‡ºè‡ªå®šä¹‰hooksçš„ç”¨æ³•ï¼ŒåŸºäºlodash/debounceå®ç°äº†ä¸€ä¸ªèŠ‚æµhooksï¼Œå…¶å®æ ¸å¿ƒå°±æ˜¯ç®€åŒ–debounceçš„ç”¨æ³•ï¼Œå½“ç„¶lodash/debounceè¿˜æœ‰æ›´å¤šçš„é…ç½®ï¼Œè‡ªå·±å¯ä»¥åŸºäºè‡ªå·±çš„å®é™…åœºæ™¯è¿›è¡Œå°è£…

è‡³äºèŠ‚æµå‡½æ•°å°±ä½œä¸ºä¸€ä¸ªæ€è€ƒé¢˜å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸‹

### å°ç»“
è‡ªå®šä¹‰hookså¯ä»¥ç»´æŠ¤åœ¨é¡¹ç›®ä¸­çš„ä¸€ä¸ªå•ç‹¬hooksæ–‡ä»¶å¤¹å†…ï¼Œä½œä¸ºå…¨å±€å…¬å…±æ–¹æ³•æä¾›ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å‘å¸ƒåˆ°è‡ªå·±çš„npmç»„ä»¶ï¼Œæä¾›ç»™æ›´å¤šçš„é¡¹ç›®ä½¿ç”¨ã€‚è¿˜æœ‰è·Ÿå¤šçš„ç”¨æ³•å°±ä¸å†ä¸€ä¸€æ¼”ç¤ºäº†ï¼Œå¯ä»¥è‡ªå·±å®ç°ä¸€äº›ï¼Œå·²åŠ æ·±å¯¹è‡ªå®šä¹‰hooksçš„ç†è§£

## React V18æ–°å¢äº†å“ªäº›hooks API

React V18å·²ç»å‘å¸ƒäº†ä¸€æ®µæ—¶é—´äº†ï¼Œé’ˆå¯¹hooksä¹Ÿæä¾›äº†ä¸€äº›æ–°çš„APIã€‚æ–°å¢çš„APIæœ‰`useIdï¼ŒuseInsertionEffectï¼ŒuseTransitionï¼ŒuseDeferredValueï¼ŒuseSyncExternalStore`ï¼Œè®©æˆ‘ä»¬ä¸€ä¸€çœ‹çœ‹æä¾›äº†ä»€ä¹ˆæ–°çš„èƒ½åŠ›ã€‚

### Beforeï¼Œå…ˆçœ‹çœ‹React V18å¸¦æ¥äº†ä»€ä¹ˆ
å¯ä»¥å¯é€‰çš„å¼€å¯ Concurrent Modeï¼Œå¤§å¹…æé«˜äº†Reactçš„æ€§èƒ½ï¼Œæ¨å‡ºäº†æ—¶é—´åˆ‡ç‰‡å’Œä»»åŠ¡ä¼˜å…ˆçº§çš„æ¦‚å¿µï¼Œè®© React æœ‰äº†æ›´å¤šçš„å¯èƒ½æ€§ï¼Œæ›´å¤šçš„æè¿°å¯ä»¥å»çœ‹çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬å…³æ³¨çš„ç‚¹è¿˜æ˜¯è¿™å‡ ä¸ªæ–°å¢çš„hooksï¼Œè®©æˆ‘ä»¬ç®€å•çš„äº†è§£ä¸€ä¸‹è¿™å‡ ä¸ªAPIï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹

### useSyncExternalStore
é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªAPIæ˜¯é’ˆå¯¹Reactçš„ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†åº“çš„ã€‚ç”±äºV18å¯ä»¥å¼€å¯concurrent mode,ä½¿å¾—renderè¿™ä¸ªè¿‡ç¨‹èƒ½å¤Ÿåˆ‡åˆ†æˆä»¥fiberä¸ºæœ€å°å•ä½çš„å¤šæ¬¡ä»»åŠ¡,è¿™äº›ä»»åŠ¡å¯èƒ½å°±ä¼šå­˜åœ¨å¯¹å¤–éƒ¨çŠ¶æ€çš„ä¿®æ”¹ï¼ŒåŠ å…¥åœ¨renderçš„ä»»åŠ¡åˆ†ç‰‡å‰åéƒ¨åˆ†çŠ¶æ€è¢«ä¿®æ”¹äº†ï¼Œé‚£å°±ä¼šé€ æˆå¤šæ¬¡æ¸²æŸ“ç»“æœä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯**tearing é—®é¢˜**ï¼Œtearing é€šä¿—åœ°è®²ï¼Œå°±æ˜¯å¤–éƒ¨çŠ¶æ€ä¸å— react å¼‚æ­¥è°ƒåº¦æ§åˆ¶ï¼Œéå¸¸å®¹æ˜“é”™ä¹±ã€‚useSyncExternalStoreå°±æ˜¯é˜²æ­¢tearingçš„å‡ºç°ï¼Œé€šè¿‡è®¢é˜…çš„æ–¹å¼ä¿æŒæœ€ç»ˆæ¸²æŸ“ç»“æœçš„ä¸€è‡´æ€§ã€‚

æœ€åç®€å•çœ‹çœ‹API
```js
useSyncExternalStore(
    subscribe, // æ¥æ”¶ä¸€ä¸ªsubscribeå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‡½æ•°ç”¨äºé€šçŸ¥reactå¤–éƒ¨çŠ¶æ€å‘ç”Ÿå˜æ›´
    getSnapshot, // è¿”å›å¤–éƒ¨çŠ¶æ€çš„æœ€æ–°å¿«ç…§å€¼
)
```
### useTransition
transition ç‰¹æ€§ä¹Ÿæ˜¯ä¾èµ– concurrent modeçš„ï¼Œå¯ä»¥ç”¨æ¥é™ä½æ¸²æŸ“ä¼˜å…ˆçº§ã€‚å½“æˆ‘ä»¬ç”¨startTransitionåŒ…è£¹è®¡ç®—é‡å¤§çš„å‡½æ•°çš„æ—¶å€™ï¼Œå°±ç›¸å½“äºé€šçŸ¥äº†Reactå½“å‰è®¡ç®—çš„ä¼˜å…ˆçº§å¾ˆä½ï¼Œå¯ä»¥é™ä½æ›´æ–°çš„ä¼˜å…ˆçº§ï¼Œå‡å°‘é‡å¤æ¸²æŸ“æ¬¡æ•°ï¼Œå¯ä»¥å½“æˆä¸€ä¸ªé˜²æŠ–å‡½æ•°æ¥å¤„ç†ï¼ˆä¸å®Œå…¨ç›¸åŒï¼‰ã€‚

```js
const Demo = () => {
  const [isPending, startTransition] = useTransition();
  return (
      <input
        type="text"
        onChange={(event) => {
          startTransition(() => {console.log(event.target.value);
        }}}
      />
  );
}
```

å¯ä»¥çœ‹çœ‹å®˜æ–¹çš„è¿™ä¸ª[demo](https://codesandbox.io/s/sparkling-field-41z4r3)

### useDeferredValue
å’ŒuseTransitionç±»ä¼¼ï¼ŒuseDeferredValueçš„ç‰¹æ€§ä¹Ÿæ˜¯ä¾èµ– concurrent mode çš„, å¯ä»¥ç›´æ¥ç¿»è¯‘ä¸ºä½¿ç”¨ä¸€ä¸ªæ¨è¿Ÿçš„å€¼ã€‚ useDeferredValue å¯ä»¥è®©æˆ‘ä»¬å»¶è¿Ÿæ¸²æŸ“ä¼˜å…ˆçº§ä¸é«˜çš„éƒ¨åˆ†ï¼Œç­‰é«˜ä¼˜å…ˆçº§çš„æ¸²æŸ“ä»»åŠ¡ç»“æŸåï¼Œå»¶è¿Ÿçš„æ¸²æŸ“æ‰å¼€å§‹ï¼Œå¹¶ä¸”å¯ä¸­æ–­ä¸ä¼šé˜»å¡ç”¨æˆ·è¾“å…¥ã€‚

```js
const Demo = (value) => {
  // React å°†ä¼šåœ¨åˆé€‚çš„æ—¶é—´ç”ŸæˆdeferredValue
  const deferredValue = useDeferredValue(value, { timeoutMs: 1000 });
  return (
    <div>
      {
        //
        deferredValue
      }
    </div>
  );
}
```

### useInsertionEffect
ç±»ä¼¼useLayoutEffectï¼ŒåŒºåˆ«å°±æ˜¯ä¸èƒ½è®¿é—®dom

useInsertionEffectçš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³cssinjsé—®é¢˜çš„ï¼Œç”¨äºæ’å…¥æ ·å¼è§„åˆ™ï¼Œè€Œä¸”ä¸€èˆ¬æ˜¯æ’å…¥å…¨å±€DOMèŠ‚ç‚¹ï¼Œæ¯”å¦‚`<style/>`ç­‰ã€‚è¿™ä¸ªhooksä¸ºäº†é¿å…åœ¨concurrent modeä¸‹ï¼Œå®¢æˆ·ç«¯ç”Ÿæˆæˆ–ç¼–è¾‘`<style/>`æ—¶å¼•èµ·æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥åœ¨è¿™ä¸ªhooksä¸­æ“ä½œæ’å…¥ä¸€äº›cssèŠ‚ç‚¹
```js
function useCSS(rule) {
  useInsertionEffect(() => {
    document.head.appendChild(rule);
  });
  return rule;
}
const Demo = () => {
  let className = useCSS(rule);
  return <div className={className} />;
}
```

### useID
ä¸€èˆ¬ç”¨äºæœåŠ¡ç«¯æ¸²æŸ“ï¼Œç”Ÿæˆä¸€ä¸ªIDï¼Œä½†æ˜¯ä¸è¦æŠŠè¿™ä¸ªIDä½œä¸ºæ•°ç»„å¾ªç¯æ¸²æŸ“çš„keyï¼Œæ¸²æŸ“çš„å”¯ä¸€keyä¸€èˆ¬æ˜¯ä»ä½ çš„æ•°æ®ä¸­ç”Ÿæˆçš„, å°±ä¸å†è¯¦ç»†ä»‹ç»äº†


## æ€»ç»“
React Hookså¾ˆå¥½ç”¨ï¼Œä½†æ˜¯æƒ³ç”¨å¥½ï¼Œè¿˜æ˜¯éœ€è¦å¤šä¸€ç‚¹æ€è€ƒçš„ã€‚æ¡†æ¶æä¾›çš„èƒ½åŠ›ï¼Œæƒ³è½¬æ¢ä¸ºå®é™…çš„ç”Ÿäº§åŠ›å°±éœ€è¦æˆ‘ä»¬ä¸åœçš„å»å­¦ä¹ å¦‚ä½•ä½¿ç”¨è¿™äº›èƒ½åŠ›ï¼Œä¸æ–­æ€»ç»“ï¼Œæœ‰é—®é¢˜å¯ä»¥ç•™è¨€äº¤æµ


**å‚è€ƒèµ„æ–™**

[Refs å’Œ DOMå®˜æ–¹æ–‡æ¡£](https://react.html.cn/docs/refs-and-the-dom.html)
[è‡ªå®šä¹‰ Hook](https://zh-hans.reactjs.org/docs/hooks-custom.html)
[å¦‚ä½•ç†è§£ React 18 ä¸­çš„ useSyncExternalStore ?](https://www.zhihu.com/question/502917860)
[useTransition/useDerferredValueä½¿ç”¨æŒ‡å—](https://blog.shabby.in/how-to-use-useTransition/useDerferredValue/)

![](http://static.zhyjor.com/wexin.png)
